<!doctype html>
<html>
	<head>
		<link rel="stylesheet" href="./lib/leaflet.css">
		<script src="./lib/leaflet-src.js"></script>
		<script src="./lib/proj4.min.js"></script>
		<script src="./lib/proj4leaflet.js"></script>
		<style>
			/*
			body {
			  padding: 0;
			  margin: 0;
			}
			*/
			.map {
			  height: 270px;
			  margin-top: 10px;
			}
		</style>
	</head>
	<body>
		<div id="map" class="map"></div>
		<script src="local.js"></script>
		<script>
			async function jsons() {
				let urlNames = {};
				let jsonUrls = [
					/**/
					'greece-regions-2100',
					'greece-prefectures',
					/**/
					//'london_boroughs'
				].map(name => {
					let url = new URL(
						`./test/files/dbs/${name}.geojson`,
						window.location.href
					).toString();
					urlNames[url] = name;
					return url;
				});
				return fetchAll(
					jsonUrls, 'json', {urlNames}
				).then(handleJson);
			}
			
			jsons().then(layers => {
				let map = build_map('map');
				
				let osm = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
					maxZoom: 19,
					attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
				});
				
				/**/
				let osmHOT = L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
					maxZoom: 19,
					attribution: '&copy; OpenStreetMap contributors, Tiles style by Humanitarian OpenStreetMap Team hosted by OpenStreetMap France'
				});
				
				let openTopoMap = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
					maxZoom: 19,
					attribution: 'Map data: &copy; OpenStreetMap contributors, SRTM | Map style: &copy; OpenTopoMap (CC-BY-SA)'
				});
				openTopoMap.on('tileload', function (e) {
					//console.log(e.coords, e.tile.src);
				});
				
				let baseMaps = {
					"OpenStreetMap": osm,
					"<span style='color: red'>OpenStreetMap.HOT</span>": osmHOT,
				};
				/**/
				
				/**/
				let overlayMaps = {};
				
				let layerControl = L.control.layers(
					baseMaps, overlayMaps
				).addTo(map);
				
				layerControl.addBaseLayer(openTopoMap, "OpenTopoMap");
				/**/
				map.addLayer(osm);
				
				var transparentLayer = new L.tileLayer('', {
					style: {
						"opacity": 0,
						"fillOpacity": 0.05 // value between 0-1 or 0% - 100%
					}
				});
				//map.addLayer(transparentLayer);
				//layerControl.addOverlay(transparentLayer);
				
				for (let [name, layerInfo] of Object.entries(layers)) {
					let layer = makeLayerJSON(layerInfo.data, name, {
						"opacity": 1,
						width: 0.2,
						"fillOpacity": 0.05 // value between 0-1 or 0% - 100%
					});
					map.addLayer(layer);
					layerControl.addOverlay(layer, name);
				}
				
				show_map(map);
			});
		</script>
	</body>
</html>
